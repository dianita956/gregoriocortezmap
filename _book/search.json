[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "El Corrido Gregorio Cortez NER and Mapping book",
    "section": "",
    "text": "Preface\nThis is a Quarto book.\nTo learn more about Quarto books visit https://quarto.org/docs/books."
  },
  {
    "objectID": "01webscrapBS.html#prerequisite",
    "href": "01webscrapBS.html#prerequisite",
    "title": "1  Web Scraping Wiki tables with Beautiful Soup",
    "section": "1.1 PreRequisite",
    "text": "1.1 PreRequisite\n\nimport requests\nimport pandas as pd\nimport json #javascript object notation to store data outside python. watch videos from Matt Digital Humanities. \nfrom bs4 import BeautifulSoup \n\n\n1.1.1 List of Municipalities in Texas\n\ndef table_extraction(a,b):\n    url= a \n    file = f\"list of texas places/{b}.txt\" \n    s = requests.get(url)\n    soup= BeautifulSoup(s.text, \"html.parser\") #to tell the program to read the site as HTML (lxml)\n    table = soup.find(\"table\", class_=\"wikitable sortable\")\n    with open (file, \"w\", encoding=\"utf-8\")as f: \n        #rows=list()\n        #headerString  = \"\"\n        dataString = \"\"\n        for row in table.find_all(\"tr\"):   \n            #for th in row.find_all(\"th\"): \n                #headerString  = headerString+th.get_text(strip=True)+\"|\"\n                #print(headerString)\n                #ending a line break to organize the txt file\n            for td in row.find_all(\"td\"):\n                dataString = dataString+td.get_text(strip=True)+\"|\"\n            dataString=dataString + \"\\n\"\n        #f.write(headerString)       \n        f.write(dataString)\n\ndef do_all(a, b):\n    table_extraction(a,b)\ndo_all(\"https://en.wikipedia.org/wiki/List_of_municipalities_in_Texas\",\"List of municipalities in Texas\")"
  },
  {
    "objectID": "04GregCortezMap.html",
    "href": "04GregCortezMap.html",
    "title": "4  Mapping places from El Corrido de Gregorio Cortez",
    "section": "",
    "text": "import geopandas as gpd\nfrom pyproj import CRS\nimport pandas as pd\nimport numpy as np\n\nfrom geograpy import places\nimport re\n\nimport geopy\nfrom geopy.geocoders import ArcGIS\n\n\nimport shapely\nfrom shapely.geometry import Point\nfrom shapely.wkt import loads\nimport plotly.express as px \n\nimport contextily as cx\nimport xyzservices.providers as xyz\nimport matplotlib.pyplot as plt #to make sure there are no errors when plotting a graph\nimport pyproj\n\nimport spacy\nfrom spacy import displacy\n\nimport googlemaps\n\nimport locationtagger\nnlp = spacy.load(\"en_core_web_sm\")\n\n\ntext = \"elcorridodegregoriocortez.txt\"\nwith open(text, 'r', encoding='utf-8') as c:\n    text = c.read()\n    \ndef clean_text(text):\n    cleaned= re.sub(r'[\":;,.“”]', \"\", text)\n    return(cleaned)\ntext = clean_text(text)\n#print(text)\n\n\nTxGPE=[]\nnlp = spacy.load(\"tx_trained_ner\")\ndoc =nlp(text) \n#print(doc)\nfor ent in doc.ents:\n    #print(ent.text, ent.label_)\n    if ent.label_ == \"GPE\":\n        TxGPE.append(ent.text)\nprint(TxGPE)\n\nC:\\Users\\dmlpz\\anaconda3\\lib\\site-packages\\spacy\\util.py:837: UserWarning:\n\n[W095] Model 'en_pipeline' (0.0.0) was trained with spaCy v3.4 and may not be 100% compatible with the current version (3.3.1). If you see errors or degraded performance, download a newer compatible model or retrain your custom model with the current spaCy version. For more details and available updates, run: python -m spacy validate\n\n\n\n['Karnes', 'Gonzales', 'Laredo', 'Encinal']\n\n\n\nents = [(e.text, e.start_char, e.end_char, e.label_)for e in doc.ents]\nprint(ents)\n\nents = [(e.text)for e in doc.ents]\nprint(ents)\n\n[('Karnes', 18, 24, 'GPE'), ('Gonzales', 1051, 1059, 'GPE'), ('Laredo', 1550, 1556, 'GPE'), ('Encinal', 1864, 1871, 'GPE')]\n['Karnes', 'Gonzales', 'Laredo', 'Encinal']\n\n\n\ndisplacy.render(doc, style ='ent', jupyter=True, page=True)\n\n\n\n    \n        displaCy\n    \n\n    \n\nIn the country of \n\n    Karnes\n    GPE\n\n Look what has happened The Major Sheriff diedLeaving Román badly woundedIt must have been two in the afternoonWhen people arrivedThey said to one anotherIt is not known who killed himThey went around asking questionsAbout half an hour afterward They found that the wrongdoerHad been Gregorio CortezNow they have outlawed CortezThroughout the whole stateLet him be taken dead or alive He has killed several menThey said Gregorio Cortez With his pistol in his handI don’t regret that I killed him I regret my brother’s deathThen said Gregorio Cortez And his soul was all aflame I don’t regret that I killed himA man must defend himselfThe Americans were coming They were whiter than a dove From the fear that they had Of Cortez and of his pistol Then the Americans said Then they said fearfullyCome let us follow the trailThe wrongdoer is CortezThey set the bloodhounds on him So they could follow his trail But trying to overtake  CortezWas like following a star He struck out for \n\n    Gonzales\n    GPE\n\nWithout showing any fearFollow me cowardly rangers I am Gregorio CortezFrom Belmont he went to the ranch  They succeeded in surrounding him Quite a few more than three hundred But there he jumped their corral When he jumped their corral According to what we hearThey got into a gunfightAnd he killed them another sheriff Then said Gregorio Cortez With his pistol in his hand Don’t run you cowardly rangers From just one MexicanGregorio Cortez went out He went towards \n\n    Laredo\n    GPE\n\nThey decided not to follow Because they were afraid of himThen said Gregorio Cortez What is the use of your scheming?You cannot catch meEven with those bloodhoundsThen the Americans said If we catch you with him what shall we do?If we fight him man to man Very few of us will returnOver by El \n\n    Encinal\n    GPE\n\n According to what we hear They made him a corral And he killed them another sheriff Then said Gregorio Cortez Shooting out a lot of bulletsI have weathered thunderstormsThis little mist doesn’t bother meNow he has met a MexicanHe says to him haughtilytell me the newsI am Gregorio CortezIt is said that because of me Many people have been killedI will surrender nowBecause such things are not rightCortez says to JesúsAt last you are going to see itGo tell the rangersTo come and arrest meAll the rangers were coming Coming so fast they even flew For they wanted to get The thousand dollars they were offered When they surrounded the house Cortez suddenly appeared before   them You will take me if I’m willing But not any other wayThen the Major Sheriff said As if he was going to cry Cortez hand over your weaponsWe are not going to killThen said Gregorio CortezShouting to them in a loud voiceI won’t surrender my armsUntil I am in a cellThen said Gregorio CortezHe said in his godly voice I won’t surrender my armsUntil I’m inside a jailNow they have taken CortezNow matters are at an end His poor familyAre suffering in their heartsNow with this I say farewell In the shade of a cypress treeThis is the end of the singing of the ballad of Cortez\n\n\n\n\n\n\ndf = pd.DataFrame(ents, columns=[\"NER_Places\"])\ngeolocator = ArcGIS(user_agent='CorridosMap')\ngeocode = lambda query: geolocator.geocode(\"%s, Texas\" % query)\ndf['Location'] = df['NER_Places'].apply(geocode)\n#df['geometry'] = df['NER_Places'].apply(geocode)\ndf\n\n\n\n\n\n  \n    \n      \n      NER_Places\n      Location\n    \n  \n  \n    \n      0\n      Karnes\n      (Karnes County, Texas, (28.905630820000056, -9...\n    \n    \n      1\n      Gonzales\n      (Gonzales, Texas, (29.500150000000076, -97.452...\n    \n    \n      2\n      Laredo\n      (Laredo, Texas, (27.530920000000037, -99.50230...\n    \n    \n      3\n      Encinal\n      (Encinal, Texas, (28.046230000000037, -99.3566...\n    \n  \n\n\n\n\n\ngdf = gpd.tools.geocode(df.Location, provider='ArcGIS')\ngdf\n\n\n\n\n\n  \n    \n      \n      geometry\n      address\n    \n  \n  \n    \n      0\n      POINT (-97.85942 28.90563)\n      Karnes County, Texas\n    \n    \n      1\n      POINT (-97.45223 29.50015)\n      Gonzales, Texas\n    \n    \n      2\n      POINT (-99.50231 27.53092)\n      Laredo, Texas\n    \n    \n      3\n      POINT (-99.35670 28.04623)\n      Encinal, Texas\n    \n  \n\n\n\n\n\npx.set_mapbox_access_token(open(\"mapboxtoken\").read())\nfig = px.line_mapbox(gdf,\n                        lat=gdf.geometry.y,\n                        lon=gdf.geometry.x,\n                        hover_name=\"address\",\n                       \n                        )\n\nfig.update_layout(mapbox_style=\"stamen-terrain\", mapbox_zoom=6, mapbox_center_lat = 29,\n    margin={\"r\":0,\"t\":0,\"l\":0,\"b\":0})\n\n\n\nfig.show()"
  }
]